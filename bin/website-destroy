#! /usr/bin/env bash
set -e # stop the execution of the script if it fails

aws s3 rm s3://logs.warnerbell.com --recursive

aws s3 rm s3://warnerbell.com --recursive

aws s3 rm s3://logs.warnerbell.com --recursive

aws route53 list-hosted-zones-by-name --dns-name warnerbell.com --query 'HostedZones[0].Id' --output text | awk -F "/" '{print $3}' | xargs -I {} aws route53 list-resource-record-sets --hosted-zone-id {} --query "ResourceRecordSets[?Type == 'CNAME'].Name" --output text | awk '{print "{\"Name\":\""$1"\", \"Type\":\"CNAME\"},"}' | xargs -I {} aws route53 change-resource-record-sets --hosted-zone-id hosted-zone-id --change-batch '{"Changes": [{"Action": "DELETE", "ResourceRecordSet": '"{}"'}]}'


aws cloudformation delete-stack \
 --stack-name "CRC-s3buckets"

 aws cloudformation delete-stack \
 --stack-name "Cldfrnt-Distro"

 aws cloudformation delete-stack \
 --stack-name "CRC-ddbLambdaApi"